# Parametric CAD Kernel

An open-source parametric CAD system written in Rust, targeting browser deployment via WebAssembly.

## Rendered Output

Generated by tessellating B-Rep solids and projecting to SVG with painter's algorithm shading.

<table>
<tr>
<td><img src="docs/renders/box.svg" alt="Box" width="400"/></td>
<td><img src="docs/renders/cylinder.svg" alt="Cylinder" width="400"/></td>
</tr>
<tr>
<td><img src="docs/renders/sphere.svg" alt="Sphere" width="400"/></td>
<td><img src="docs/renders/extrude_l.svg" alt="Extruded L-Profile" width="400"/></td>
</tr>
<tr>
<td><img src="docs/renders/revolve_vase.svg" alt="Revolved Vase" width="400"/></td>
<td><img src="docs/renders/chamfer_box.svg" alt="Chamfered Box" width="400"/></td>
</tr>
</table>

To regenerate: `cargo run -p cad-render`

## Architecture

```
crates/
  kernel/        - B-Rep topology, geometry, Boolean ops, operations
  tessellation/  - Triangle mesh generation, OBJ/STL export
  solver/        - 2D constraint solver (Gauss-Newton + Levenberg-Marquardt)
  wasm-bridge/   - WebAssembly API wrapping the kernel
  render/        - SVG render and mesh export generation (dev tool)
```

## Key Features

**Geometry Engine**
- Points, vectors, transforms, bounding boxes
- Curves: lines, circles, ellipses, NURBS
- Surfaces: planes, cylinders, cones, spheres, tori, NURBS
- Ray intersection: plane, sphere, cylinder, AABB, line-line

**B-Rep Topology**
- Half-edge data structure with SlotMap arena allocation
- Euler-Poincare validation (V - E + F = 2)
- Topology auditing (closed loops, twin consistency)

**Solid Operations**
- Primitives: box, cylinder, sphere
- Extrude: arbitrary 2D profiles along a direction
- Revolve: profiles around an arbitrary axis (lathe)
- Chamfer: edge beveling on box primitives
- Boolean: union, intersection, difference (AABB grid decomposition for overlapping boxes)

**Parametric Feature Tree**
- Sketch, Extrude, Revolve, Chamfer, Boolean features
- Named parameters with expression support
- Full re-evaluation on parameter changes

**Constraint Solver**
- 13 constraint types: coincident, distance, angle, parallel, perpendicular, horizontal, vertical, tangent, symmetric, equal, radius, fixed, point-on-entity
- Gauss-Newton with Levenberg-Marquardt damping
- Analytic Jacobians for quadratic convergence

**Tessellation & Export**
- Ear-clipping triangulation for planar faces (handles concave polygons)
- UV grid sampling for parametric surfaces
- OBJ and binary STL export
- f32 output for WebGL compatibility

## Building

```bash
cargo build --workspace
cargo test --workspace       # 121 tests
cargo run -p cad-render      # generate SVG renders + OBJ/STL exports
```

Exported mesh files are written to `docs/exports/` (OBJ, STL).

## Tests

121 tests across 5 crates:
- **83** kernel (topology, geometry, boolean, chamfer, feature tree, validation)
- **10** property-based (proptest)
- **15** solver (constraint types, linear system, multi-constraint sketches)
- **9** tessellation (ear-clipping, concave polygons, OBJ/STL export)
- **4** wasm-bridge
